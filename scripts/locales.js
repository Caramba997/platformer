const locales = {
  DE: {
    undefined: '???',
    fps: 'FPS',
    level: 'Level',
    time: 'Zeit',
    coins: 'Münzen',
    points: 'Punkte',
    selectLevel: 'Level wählen',
    newLevel: 'Neues Level',
    save: 'Speichern',
    play: 'Spielen',
    newProp: 'Neues Objekt',
    outline: 'Explorer',
    world: 'Welt',
    meta: 'Meta',
    player: 'Spieler',
    finish: 'Ziel',
    props: 'Objekte',
    enemies: 'Gegner',
    chooseLevel: 'Wähle ein Level zum Bearbeiten',
    load: 'Laden',
    or: 'oder',
    new: 'Neu',
    createNewProp: 'Neues Objekt erstellen',
    staticProp: 'Statisches Objekt',
    movingProp: 'Bewegliches Objekt',
    block: 'Block',
    enemy: 'Gegner',
    flyingEnemy: 'Fliegender Gegner',
    coin: 'Münze',
    create: 'Erstellen',
    saveLevel: 'Level speichern',
    copy: 'Kopieren',
    duplicate: 'Duplizieren',
    remove: 'Entfernen',
    place: 'Platzieren',
    editor: 'Editor',
    confirm: 'Bestätigen',
    backToStart: 'Zurück zum Hauptmenü',
    sureBackToStart: 'Bist du sicher dass du zum Hauptmenü zurückkehren möchtest? Nicht gespeicherte Fortschritte gehen verloren.',
    backToMainMenu: 'Möchtest du zum Hauptmenü zurückkehren?',
    mainMenu: 'Hauptmenü',
    completed: 'Abgeschlossen',
    gameOver: 'Game over',
    gameOverTime: 'Die Zeit ist abgelaufen.',
    gameOverDead: 'Du bist gestorben.',
    gameOverText: 'Möchtest du es erneut versuchen?',
    replay: 'Neustart',
    pause: 'Pause',
    levelComplete: 'Level geschafft',
    levelCompleteText: 'Herzlichen Glückwunsch, du hast das Level gemeistert!',
    centerPosition: 'Marker-Position',
    spawner: 'Spawner',
    thumbnail: 'Vorschaubild generieren',
    loading: 'Lade...',
    statusInit: 'Initialisierung',
    statusTextures: 'Lade Texturen',
    statusSounds: 'Lade Sounds',
    statusScripts: 'Lade Scripte',
    statusExecution: 'Scripts ausführen',
    statusLoaded: 'Laden erfolgreich',
    keepCenter: 'Marker-Position behalten',
    backgroundProp: 'Hintergrund-Objekt',
    water: 'Wasser',
    login: 'Anmelden',
    profile: 'Profil',
    enterUserData: 'Nutzerdaten eingeben',
    username: 'Nutzername',
    password: 'Passwort',
    id: 'ID',
    noAccountYet: 'Du hast noch keinen Account? Gebe oben Nutzername und Passwort ein und registriere dich mit dem folgenden Button.',
    register: 'Registrieren',
    logout: 'Abmelden',
    errorMissingUserData: 'Du musst Nutzername und Passwort eingeben',
    errorUsernameTaken: 'Der Nutzername ist bereits vergeben, versuche einen anderen',
    errorLoginFailed: 'Anmeldung fehlgeschlagen. Überprüfe deine Eingaben oder versuche es später erneut',
    errorRegisterFailed: 'Registrierung fehlgeschlagen. Überprüfe deine Eingaben oder versuche es später erneut',
    errorInvalidCredentials: 'Anmeldung fehlgeschlagen. Password nicht korrekt',
    showSourcecode: 'Quelltext anzeigen',
    hideSourcecode: 'Quelltext verbergen',
    uploadComplete: 'Speichern erfolgreich',
    uploadFailes: 'Speichern fehlgeschlagen',
    createdLevels: 'Eigene Levels',
    communityLevels: 'Community-Levels',
    loginForMoreLevels: 'Melde dich an, um deinen Fortschritt zu speichern, eigene Levels zu erstellen und Community-Levels zu spielen',
    browseLevels: 'Alle anzeigen',
    browse: 'Alle Levels',
    edit: 'Bearbeiten',
    delete: 'Löschen',
    sureDelete: 'Bist du sicher, dass du dieses Level löschen möchtest?',
    subscribe: 'Abonnieren',
    unsubscribe: 'Deabonnieren',
    by: 'von',
    help: 'Hilfe',
    highscores: 'Bestenliste',
    score: 'Score',
    thumbnailInfo: 'Du kannst aus der aktuell sichtbaren Spielszene ein Vorschaubild generieren und hochladen. Positioniere die Szene so, dass die Vorschau dein Level gut repräsentiert.',
    hintMobile: 'Auf Mobilgeräten wird Vollbild empfohlen, du kannst dies im Hauptmenü aktivieren.',
    refreshProfile: 'Profildaten aktualisieren'
  },
  EN: {
    undefined: '???',
    fps: 'FPS',
    level: 'Level',
    time: 'Time',
    coins: 'Coins',
    points: 'Points',
    selectLevel: 'Select level',
    newLevel: 'New level',
    save: 'Save',
    play: 'Play',
    newProp: 'New Prop',
    outline: 'Explorer',
    world: 'World',
    meta: 'Meta',
    player: 'Player',
    finish: 'Finish',
    props: 'Props',
    enemies: 'Enemies',
    chooseLevel: 'Choose a level to edit',
    load: 'Load',
    or: 'or',
    new: 'New',
    createNewProp: 'Create new prop',
    staticProp: 'Static Prop',
    movingProp: 'Moving Prop',
    block: 'Block',
    enemy: 'Enemy',
    flyingEnemy: 'Flying Enemy',
    coin: 'Coin',
    create: 'Create',
    saveLevel: 'Save level',
    copy: 'Copy',
    duplicate: 'Duplicate',
    remove: 'Remove',
    place: 'Place',
    editor: 'Editor',
    confirm: 'Confirm',
    backToStart: 'Back to main menu',
    sureBackToStart: 'Are you sure you want to return to main menu? Save your progress beforehand or it will be lost.',
    backToMainMenu: 'Do you want to return to main menu?',
    mainMenu: 'Main menu',
    completed: 'Completed',
    gameOver: 'Game over',
    gameOverTime: 'You ran out of time.',
    gameOverDead: 'You died.',
    gameOverText: 'Do you want to try again?',
    replay: 'Play again',
    pause: 'Pause',
    levelComplete: 'Level complete',
    levelCompleteText: 'Congratulations, you finished the level!',
    centerPosition: 'Center position',
    spawner: 'Spawner',
    thumbnail: 'Create thumbnail',
    loading: 'Loading...',
    statusInit: 'Initialization',
    statusTextures: 'Loading textures',
    statusSounds: 'Loading sounds',
    statusScripts: 'Loading scripts',
    statusExecution: 'Executing scripts',
    statusLoaded: 'Loading successfull',
    keepCenter: 'Keep center position',
    backgroundProp: 'Background Prop',
    water: 'Water',
    login: 'Login',
    profile: 'Profile',
    enterUserData: 'Enter user data',
    username: 'Username',
    password: 'Password',
    id: 'ID',
    noAccountYet: 'You don\'t have an account yet? Enter your credentials above and register with the following button.',
    register: 'Register',
    logout: 'Abmelden',
    errorMissingUserData: 'You need to fill in your username and password',
    errorUsernameTaken: 'Username is already taken, try another one',
    errorLoginFailed: 'Login failed. Check your credentials or try again later',
    errorRegisterFailed: 'Registration failed. Check your credentials or try again later',
    errorInvalidCredentials: 'Login failed. Invalid password',
    showSourcecode: 'Show sourcecode',
    hideSourcecode: 'Hide sourcecode',
    uploadComplete: 'Upload complete',
    uploadFailes: 'Upload failed',
    createdLevels: 'Created levels',
    communityLevels: 'Community levels',
    loginForMoreLevels: 'Login to save your progress, create your own levels and play community levels',
    browseLevels: 'Browse levels',
    browse: 'Browse levels',
    edit: 'Edit',
    delete: 'Delete',
    sureDelete: 'Are you sure you want to delete this level?',
    subscribe: 'Subscribe',
    unsubscribe: 'Unsubscribe',
    by: 'by',
    help: 'Help',
    highscores: 'Highscores',
    score: 'Score',
    thumbnailInfo: 'You can create and upload a thumbnail out of the currently visible scene. Adjust your scene view to provide a good impression of your level.',
    hintMobile: 'Fullscreen mode is recommended for mobile devices, you can enable it in the main menu.',
    refreshProfile: 'Refresh profile data'
  }
}

class Locales {
  constructor() {
    this.locales = locales;
    if (!window.ps.load('language')) {
      window.ps.save('language', 'DE');
    }
    this.language = window.ps.load('language');
    this.t = this.locales[this.language];
  }

  /**
   * Changes the languages
   * @param {String} language Language
   */
  changeLanguage(language) {
    window.ps.save('language', language);
    this.language = language;
    this.t = this.locales[this.language];
  }

  /**
   * Translates all the [data-t] elements of a given container
   * @param {Element} container The Element where all recursive children are translated
   */
  translatePage(container) {
    container.querySelectorAll('[data-t]').forEach((element) => {
      element.innerText = this.getTranslation(element.getAttribute('data-t'));
    });
  }

  /**
   * Translates a HTML String by replacing all {{example}} occurences
   * @param {String} raw HTML String to be translated
   * @returns Translated HTML String
   */
  translateRaw(raw) {
    const shortcodes = raw.match(/{{\s*t:\w+\s*}}/g);
    let result = raw;
    if (shortcodes) {
      shortcodes.forEach((shortcode) => {
        const word = shortcode.replace(/{{\s*t:/, '').replace(/\s*}}/, '');
        result = result.replace(shortcode, this.getTranslation(word));
      });
    }
    return result;
  }

  /**
   * Translates a single word or String
   * @param {String} word ID of the text to be translated
   * @returns Translated String
   */
  getTranslation(word) {
    return this.t[word] ? this.t[word] : this.t['undefined'];
  }
}

window.locales = new Locales();